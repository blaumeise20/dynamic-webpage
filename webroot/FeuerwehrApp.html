<!doctype html>
<html>
<head>
   <meta charset="UTF-8"/>
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   <title>Feuerwehr App</title>
   <script type="text/javascript" src="lib/jquery-3.5.0.min.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/dynamicPageLibrary.js" charset="UTF-8"></script>
   <script src="/socket.io/socket.io.js" charset="UTF-8"></script>
   <script>
	   var bus = new common.infrastructure.bus.Bus();
			
		var deleteAddress = function deleteAddress(street, number) {
			bus.sendCommand(webapp.shared.topics.REMOVE_ADDRESS_FROM_NOT_AT_HOME_LIST, {street: street, number: number} );
		};
			
		$(document).ready(function() {
			
			var addAddressToNotAtHomeList = function addAddressToNotAtHomeList() {
				bus.sendCommand(webapp.shared.topics.ADD_ADDRESS_TO_NOT_AT_HOME_LIST, {street: $('#street').val(), number: $('#number').val()} );
			};
			
			var onActuallyNotAtHome = function onActuallyNotAtHome(notAtHomeList){
				var htmlCode = '<table border="1">';
				htmlCode += '<tbody>';
				
				notAtHomeList.forEach(addr => {
					addr.number.forEach(num => {
						htmlCode += '<tr>';
						htmlCode += '<td>' + addr.street + '</td>';
						htmlCode += '<td>' + num + '</td>';
						htmlCode += '<td><button onclick="deleteAddress(\'' + addr.street + '\', \'' + num + '\')">Löschen</button></td>';
						htmlCode += '</tr>';
					});
				});
				
				htmlCode += '</tbody>';
				htmlCode += '</table>';
				$('#notAtHome').html(htmlCode);
			}
			
			$('#addAddressButton').click(addAddressToNotAtHomeList);
			$('#number').keypress(function (e) {
				var key = e.which;
				if(key == 13)  // the enter key code
				{
					addAddressToNotAtHomeList();
					return false;  
				}
			});   
			bus.subscribeToPublication(webapp.shared.topics.ACTUALLYNOTATHOME, onActuallyNotAtHome);
			var topicsToTransmit = [webapp.shared.topics.ADD_ADDRESS_TO_NOT_AT_HOME_LIST, webapp.shared.topics.REMOVE_ADDRESS_FROM_NOT_AT_HOME_LIST];
			var busBridge = new common.infrastructure.busbridge.ClientSocketIoBusBridge(bus, topicsToTransmit, io);
      });
   </script>
</head>

<body>
<h1>Feuerwehr App</h1>
<table class="table table-sm">
	<tbody>
	<tr>
		<td>Straße</td>
		<td><input id="street" value="" size="40" type="text"></td>
	</tr>
	<tr>
		<td>Hausnummer:</td>
		<td><input id="number" value="" size="40" type="text"></td>
	</tr>
	<tr>
		<td colspan="2"><button id="addAddressButton">Senden</button></td>
	</tr>
	</tbody>
</table>

<div id="notAtHome"></div>

</body>
</html>  
