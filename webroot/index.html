<!doctype html>
<html>
<head>
   <meta charset="UTF-8"/>
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   <title>dynamic Webpage</title>
   <script type="text/javascript" src="lib/jquery-3.5.0.min.js" charset="UTF-8"></script>
   <script type="text/javascript" src="javascripts/dynamicPageLibrary.js" charset="UTF-8"></script>
   <script src="/socket.io/socket.io.js" charset="UTF-8"></script>
   <script>
		$(document).ready(function() {
         var onConnectedStateChanged = function onConnectedStateChanged(data) {
				console.log('connection state = ' + data);
			};
			
			var onChatMessage = function onChatMessage(data) {
				console.log('neue Nachricht ' +JSON.stringify(data));
			};
			
			var sendChatMessage = function sendChatMessage() {
				console.log('sendChatMessage' +$('#name').val() );
				bus.sendCommand(webapp.shared.topics.CHAT_MESSAGE, {name: $('#name').val(), nachricht: $('#nachricht').val()} );
			};
			
			$('#senden').click(sendChatMessage);
			
			var bus = new common.infrastructure.bus.Bus();
			bus.subscribeToPublication(common.infrastructure.busbridge.CONNECTION_STATE_TOPIC, onConnectedStateChanged);
			bus.subscribeToCommand(webapp.shared.topics.CHAT_BROADCAST, onChatMessage);
			var topicsToTransmit = [webapp.shared.topics.CHAT_MESSAGE];
			var busBridge = new common.infrastructure.busbridge.ClientSocketIoBusBridge(bus, topicsToTransmit, io);
      });
   </script>
</head>

<body>
<h1>Hello World!</h1>
<table class="table table-sm">
	<tbody><tr>
		<td>Name:</td>
		<td><input id="name" value="" size="40" type="text"></td>
	</tr>
	<tr>
		<td>Nachricht:</td>
		<td><input id="nachricht" value="" size="40" type="text"></td>
	</tr>
	<tr>
		<td>Chat:</td>
		<td><textarea id="comment" rows="5" cols="30"></textarea></td>
	</tr>
	<tr>
		<td colspan="2"><button id="senden">Senden</button></td>
	</tr>
   </tbody>
</table>
</body>
</html>  